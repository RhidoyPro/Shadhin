generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "mongodb"
  url      = env("DATABASE_URL")
}

enum UserRole {
  USER
  ADMIN
  SUPER_USER
}

model User {
  id            String          @id @default(auto()) @map("_id") @db.ObjectId
  name          String
  firstName     String?
  lastName      String?
  email         String?         @unique
  hashedPassword String?
  phone         String?
  university    String?
  dateOfBirth   DateTime?
  emailVerified DateTime?
  image         String?
  stateName     String?
  accounts      Account[]
  role          UserRole        @default(USER)
  events         Event[]
  comments      Comment[]
  likes         Like[]
  eventAttendees EventAttendee[]
  messages      Message[]
  notifications Notification[]
  reports       Report[]
  
  points        Int             @default(0)
 
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}
 
model Account {
  id                String  @id @default(auto()) @map("_id") @db.ObjectId
  userId            String  @db.ObjectId
  type              String
  provider          String
  providerAccountId String
  refresh_token     String? @db.String
  access_token      String? @db.String
  expires_at        Int?
  token_type        String?
  scope             String?
  id_token          String? @db.String
  session_state     String?
 
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
 
  user User @relation(fields: [userId], references: [id], onDelete: Cascade)
 
  @@unique([provider, providerAccountId])
}

model VerificationToken {
  id       String   @id @default(auto()) @map("_id") @db.ObjectId
  email    String
  token    String  @unique
  expires  DateTime

  @@unique([email, token])
}

model ForgotPasswordCode {
  id       String   @id @default(auto()) @map("_id") @db.ObjectId
  email    String
  code     String  @unique
  expires  DateTime

  @@unique([email, code])
}

enum EventType {
  STATUS
  EVENT
}

model Event {
  id         String   @id @default(auto()) @map("_id") @db.ObjectId
  content   String
  eventType EventType
  type      String?
  mediaUrl  String?
  stateName String
  userId    String  @db.ObjectId
  user      User    @relation(fields: [userId], references: [id], onDelete: Cascade)
  comments  Comment[]
  likes     Like[]
  attendees EventAttendee[]
  notifications Notification[]
  reports   Report[]

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@index([userId])
}

model Comment {
  id         String   @id @default(auto()) @map("_id") @db.ObjectId
  content    String
  eventId     String  @db.ObjectId
  userId     String  @db.ObjectId
  user       User    @relation(fields: [userId], references: [id], onDelete: Cascade)
  event       Event    @relation(fields: [eventId], references: [id], onDelete: Cascade)

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@index([eventId])
  @@index([userId])
}

model Like {
  id         String   @id @default(auto()) @map("_id") @db.ObjectId
  userId     String  @db.ObjectId
  eventId     String  @db.ObjectId
  user       User    @relation(fields: [userId], references: [id], onDelete: Cascade)
  event       Event    @relation(fields: [eventId], references: [id], onDelete: Cascade)

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@index([eventId])
  @@index([userId])
}

enum EventStatus {
  GOING
  NOT_GOING
}

// model for track whether user will attend the event or not
model EventAttendee {
  id         String   @id @default(auto()) @map("_id") @db.ObjectId
  userId     String  @db.ObjectId
  eventId    String  @db.ObjectId
  status     EventStatus
  user       User    @relation(fields: [userId], references: [id], onDelete: Cascade)
  event      Event   @relation(fields: [eventId], references: [id], onDelete: Cascade)

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@index([eventId])
  @@index([userId])
}

model Message {
  id         String   @id @default(auto()) @map("_id") @db.ObjectId
  message    String
  userId     String  @db.ObjectId
  user       User    @relation(fields: [userId], references: [id], onDelete: Cascade)
  stateName  String

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

model Notification {
  id         String   @id @default(auto()) @map("_id") @db.ObjectId
  message    String
  userId     String  @db.ObjectId
  user       User    @relation(fields: [userId], references: [id], onDelete: Cascade)
  eventId    String  @db.ObjectId
  event      Event   @relation(fields: [eventId], references: [id], onDelete: Cascade)
  isRead     Boolean @default(false)

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

model Report {
  id         String   @id @default(auto()) @map("_id") @db.ObjectId
  userId     String  @db.ObjectId
  eventId    String  @db.ObjectId
  user       User    @relation(fields: [userId], references: [id], onDelete: Cascade)
  event      Event   @relation(fields: [eventId], references: [id], onDelete: Cascade)
  reason     String

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}